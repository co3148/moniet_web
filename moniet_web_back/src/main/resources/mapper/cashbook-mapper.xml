<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace = "kr.or.iei.cashbook.model.dao.CashbookDao">
  
  <select id="cashbookList" resultType="cashbook">
  	<![CDATA[
  	select
  		cashbook_no, member_no, cashbook_finance, to_char(cashbook_date, 'yyyy-mm-dd') as cashbook_date,
  		cashbook_loop, loop_month, cashbook_asset, cashbook_category,
  		(select category_title from category_tbl where category_no = cashbook.cashbook_category) as CATEGORY_TITLE,
  		cashbook_money, cashbook_content, cashbook_memo
  	from cashbook
  	where cashbook_date >= #{startDate} and cashbook_date <= #{endDate} and member_no=(select member_no from member where member_id=#{memberId})
  	order by cashbook_date desc
  	]]>
  </select>
  
  	<select id="totalSum" resultType="int">
  		<![CDATA[
		select nvl(sum(CASHBOOK_MONEY),0) from cashbook
		where cashbook_date >= #{startDate} and cashbook_date <= #{endDate} and member_no=(select member_no from member where member_id=#{memberId})
		]]>
	</select>
	<select id="sumOfIncome" resultType="int">
		<![CDATA[
		select nvl(sum(CASHBOOK_MONEY),0) from cashbook
		where CASHBOOK_FINANCE=1 and cashbook_date >= #{startDate} and cashbook_date <= #{endDate} and member_no=(select member_no from member where member_id=#{memberId})
		]]>
	</select>
	<select id="sumOfSpending" resultType="int">
		<![CDATA[
		select nvl(sum(CASHBOOK_MONEY),0) from cashbook
		where CASHBOOK_FINANCE=2 and cashbook_date >= #{startDate} and cashbook_date <= #{endDate} and member_no=(select member_no from member where member_id=#{memberId})
		]]>
	</select>
	
	<select id="totalCount" resultType="int">
		<![CDATA[
		select nvl(count(CASHBOOK_MONEY),0) from cashbook
		where cashbook_date >= #{startDate} and cashbook_date <= #{endDate} and member_no=(select member_no from member where member_id=#{memberId})
		]]>
	</select>
	<select id="countOfIncome" resultType="int">
		<![CDATA[
		select nvl(count(CASHBOOK_MONEY),0) from cashbook
		where CASHBOOK_FINANCE=1 and cashbook_date >= #{startDate} and cashbook_date <= #{endDate} and member_no=(select member_no from member where member_id=#{memberId})
		]]>
	</select>
	<select id="countOfSpending" resultType="int">
		<![CDATA[
		select nvl(count(CASHBOOK_MONEY),0) from cashbook
		where CASHBOOK_FINANCE=2 and cashbook_date >= #{startDate} and cashbook_date <= #{endDate} and member_no=(select member_no from member where member_id=#{memberId})
		]]>
	</select>
	
	<!--파이대시보드-->
	<select id="pieDash" resultType="int">
		select sum(cashbook_money) from cashbook 
		where TO_CHAR(SYSDATE, 'MM') = TO_CHAR(cashbook_date,'MM') and 
		member_no=(select member_no from member where member_id=#{memberId}) 
		group by cashbook_finance
	</select>
	
	<select id="category" resultType="category">
		select category_no, category_title, category_ref from category_tbl
		where category_default=1 and (member_no is null or member_no=(select member_no from member where member_id=#{memberId}))
		order by category_no
	</select>
	<insert id="insertCashbook">
		insert into cashbook values
			(CASHBOOK_SEQ.nextval,
			(select member_no from member where member_id=#{memberId}),
			 #{cashbookFinance},#{cashbookDate}, #{cashbookLoop},
			 #{loopMonth}, #{cashbookAsset}, #{cashbookCategory},
			 #{cashbookMoney}, #{cashbookContent}, #{cashbookMemo})
	</insert>
</mapper>
